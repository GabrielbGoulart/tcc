from kafka import KafkaConsumer
from influxdb_client import InfluxDBClient
from datetime import datetime

from influxdb_client import InfluxDBClient, Point, WritePrecision
from influxdb_client.client.write_api import SYNCHRONOUS
token = "ZkZfWC_rHz2a1NqHzbtyBQCVLW_AB0WKVZ7HJeKphhQN3JRcipkoeVr6q70HnEBZs4SM121Upcb3CRUy_i5nzQ=="
org = "ufc"
bucket = "prices"
client = InfluxDBClient(url="http://localhost:8086", token=token, org=org)
write_api = client.write_api(write_options=SYNCHRONOUS)
print('connected')
def save_price(prices):
    ts = []
    for bond, price_value in prices.items():
        ts.append(Point("price").tag("bond", bond).field("value", price_value))
    write_api.write(bucket=bucket,org=org,record=ts)
    print(datetime.now(), "add")
consumer = KafkaConsumer('b3-simulate', bootstrap_servers='localhost:9092')
stock_order=[ "AALR3",
  "AAPL34",
  "ABBV34",
  "ABCB4",
  "ABEV3",
  "ADHM3",
  "AFLT3",
  "AGRO3",
  "ALPA3",
  "ALPA4",
  "ALSC3",
  "ALUP3",
  "ALUP4",
  "ALUP11",
  "AMAR3",
  "AMGN34",
  "AMZO34",
  "ANIM3",
  "APER3",
  "ARZZ3",
  "ATOM3",
  "ATTB34",
  "AZEV4",
  "AZUL4",
  "B3SA3",
  "BAHI3",
  "BAUH4",
  "BAZA3",
  "BBAS3",
  "BBDC3",
  "BBDC4",
  "BBRK3",
  "BBSE3",
  "BEEF3",
  "BEES3",
  "BEES4",
  "BERK34",
  "BGIP4",
  "BIDI4",
  "BIIB34",
  "BIOM3",
  "BKBR3",
  "BMEB4",
  "BNBR3",
  "BOAC34",
  "BOBR4",
  "BOEI34",
  "BOXP34",
  "BPAC3",
  "BPAC5",
  "BPAC11",
  "BPAN4",
  "BRAP3",
  "BRAP4",
  "BRDT3",
  "BRFS3",
  "BRIV4",
  "BRKM3",
  "BRKM5",
  "BRML3",
  "BRPR3",
  "BRSR3",
  "BRSR6",
  "BSEV3",
  "BTOW3",
  "BTTL3",
  "CAMB4",
  "CAML3",
  "CARD3",
  "CBEE3",
  "CCPR3",
  "CCRO3",
  "CCXC3",
  "CEDO4",
  "CEEB3",
  "CELP3",
  "CELP5",
  "CELP7",
  "CESP3",
  "CESP5",
  "CESP6",
  "CGAS3",
  "CGAS5",
  "CGRA3",
  "CGRA4",
  "CHVX34",
  "CIEL3",
  "CLGN34",
  "CLSC4",
  "CMCS34",
  "CMIG3",
  "CMIG4",
  "COCA34",
  "COCE3",
  "COCE5",
  "COLG34",
  "COPH34",
  "COWC34",
  "CPFE3",
  "CPLE3",
  "CPLE6",
  "CPRE3",
  "CRDE3",
  "CRFB3",
  "CRIV3",
  "CRPG5",
  "CRPG6",
  "CSAN3",
  "CSMG3",
  "CSNA3",
  "CSRN3",
  "CSRN5",
  "CTGP34",
  "CTKA4",
  "CTNM3",
  "CTNM4",
  "CTSA3",
  "CTSA4",
  "CTSH34",
  "CVCB3",
  "CVSH34",
  "CYRE3",
  "DEAI34",
  "DIRR3",
  "DISB34",
  "DMMO3",
  "DTEX3",
  "EALT4",
  "ECOR3",
  "EGIE3",
  "EKTR4",
  "ELEK4",
  "ELET3",
  "ELET5",
  "ELET6",
  "ELPL3",
  "EMAE4",
  "EMBR3",
  "ENBR3",
  "ENEV3",
  "ENGI3",
  "ENGI4",
  "ENGI11",
  "ENMA3B",
  "ENMT3",
  "EQTL3",
  "ESTC3",
  "EUCA4",
  "EVEN3",
  "EXXO34",
  "EZTC3",
  "FBOK34",
  "FESA3",
  "FESA4",
  "FHER3",
  "FIBR3",
  "FJTA3",
  "FJTA4",
  "FLRY3",
  "FRAS3",
  "GBIO33",
  "GFSA3",
  "GGBR3",
  "GGBR4",
  "GILD34",
  "GNDI3",
  "GOAU3",
  "GOAU4",
  "GOGL34",
  "GOGL35",
  "GOLL4",
  "GPIV33",
  "GPSI34",
  "GRND3",
  "GSGI34",
  "GSHP3",
  "GUAR3",
  "GUAR4",
  "HAGA4",
  "HAPV3",
  "HBOR3",
  "HBTS5",
  "HETA4",
  "HGTX3",
  "HOME34",
  "HPQB34",
  "HYPE3",
  "IBMB34",
  "IDNT3",
  "IDVL3",
  "IDVL4",
  "IGTA3",
  "IRBR3",
  "ITLC34",
  "ITSA3",
  "ITSA4",
  "ITUB3",
  "ITUB4",
  "JBDU3",
  "JBDU4",
  "JBSS3",
  "JFEN3",
  "JHSF3",
  "JNJB34",
  "JPSA3",
  "JSLG3",
  "KEPL3",
  "KHCB34",
  "KLBN3",
  "KLBN4",
  "KLBN11",
  "KROT3",
  "LAME3",
  "LAME4",
  "LCAM3",
  "LEVE3",
  "LIGT3",
  "LILY34",
  "LINX3",
  "LIQO3",
  "LLIS3",
  "LMTB34",
  "LOGG3",
  "LOGN3",
  "LPSB3",
  "LREN3",
  "MACY34",
  "MAGG3",
  "MCDC34",
  "MDIA3",
  "MDLZ34",
  "MDTC34",
  "MEAL3",
  "METB34",
  "MGEL4",
  "MGLU3",
  "MILS3",
  "MMMC34",
  "MNDL3",
  "MNPR3",
  "MOSC34",
  "MOVI3",
  "MPLU3",
  "MRCK34",
  "MRFG3",
  "MRVE3",
  "MSBR34",
  "MSCD34",
  "MSFT34",
  "MTSA4",
  "MULT3",
  "MYPK3",
  "NATU3",
  "NFLX34",
  "NIKE34",
  "ODPV3",
  "OFSA3",
  "OGXP3",
  "OMGE3",
  "PARD3",
  "PCAR4",
  "PEAB3",
  "PEPB34",
  "PETR3",
  "PETR4",
  "PFIZ34",
  "PFRM3",
  "PGCO34",
  "PINE4",
  "PLAS3",
  "PMAM3",
  "PNVL3",
  "PNVL4",
  "POMO3",
  "POMO4",
  "POSI3",
  "PPLA11",
  "PRIO3",
  "PSSA3",
  "PTBL3",
  "PTNT4",
  "QGEP3",
  "QUAL3",
  "RADL3",
  "RAIL3",
  "RANI3",
  "RANI4",
  "RAPT3",
  "RAPT4",
  "RCSL3",
  "RCSL4",
  "RDNI3",
  "REDE3",
  "RENT3",
  "RLOG3",
  "RNEW3",
  "RNEW4",
  "RNEW11",
  "ROMI3",
  "ROST34",
  "RSID3",
  "SANB3",
  "SANB4",
  "SANB11",
  "SAPR3",
  "SAPR4",
  "SAPR11",
  "SBSP3",
  "SBUB34",
  "SCAR3",
  "SCHW34",
  "SEDU3",
  "SEER3",
  "SGPS3",
  "SHOW3",
  "SHUL4",
  "SLCE3",
  "SMLS3",
  "SMTO3",
  "SNSL3",
  "SSBR3",
  "STBP3",
  "SULA11",
  "SUZB3",
  "TAEE3",
  "TAEE4",
  "TAEE11",
  "TCSA3",
  "TECN3",
  "TELB3",
  "TELB4",
  "TEND3",
  "TESA3",
  "TEXA34",
  "TGMA3",
  "TIET3",
  "TIET4",
  "TIET11",
  "TIMP3",
  "TKNO4",
  "TOTS3",
  "TOYB4",
  "TRIS3",
  "TRPL3",
  "TRPL4",
  "TRPN3",
  "TUPY3",
  "TXRX4",
  "UCAS3",
  "UGPA3",
  "UNIP3",
  "UNIP5",
  "UNIP6",
  "UPAC34",
  "UPSS34",
  "USIM3",
  "USIM5",
  "USIM6",
  "USSX34",
  "VALE3",
  "VERZ34",
  "VISA34",
  "VIVT3",
  "VIVT4",
  "VLID3",
  "VLOE34",
  "VULC3",
  "VVAR3",
  "WALM34",
  "WEGE3",
  "WHRL3",
  "WIZS3",
  "WLMM4",
  "WSON33",
  "WUNI34",
  "XRXB34",
  "TPIS3",
  "BPHA3",
  "ETER3",
  "FRTA3",
  "GPCP3",
  "IGBR3",
  "INEP3",
  "INEP4",
  "LUPA3",
  "MMXM3",
  "MWET4",
  "OIBR3",
  "OIBR4",
  "OSXB3",
  "PDGR3",
  "SLED3",
  "SLED4",
  "TCNO3",
  "TCNO4",
  "TEKA4",
  "VIVR3",
  "PLAS1",
  "POMO2",
  "VIVR1",
  "ABCP11",
  "AEFI11",
  "AGCX11",
  "ALMI11",
  "ALZR11",
  "BBFI11B",
  "BBPO11",
  "BBRC11",
  "BBVJ11",
  "BCFF11",
  "BCIA11",
  "BCRI11",
  "BMLC11B",
  "BNFS11",
  "BPFF11",
  "BRCR11",
  "BZLI11",
  "CARE11",
  "CBOP11",
  "CEOC11",
  "CNES11",
  "CPTS11B",
  "CTXT11",
  "CXCE11B",
  "CXRI11",
  "CXTL11",
  "DRIT11B",
  "EDFO11B",
  "EDGA11",
  "EURO11",
  "FAED11",
  "FAMB11B",
  "FCFL11",
  "FEXC11",
  "FFCI11",
  "FIGS11",
  "FIIB11",
  "FIIP11B",
  "FIVN11",
  "FIXX11",
  "FLMA11",
  "FLRP11",
  "FMOF11",
  "FPAB11",
  "FVBI11",
  "FVPQ11",
  "GGRC11",
  "GRLV11",
  "HCRI11",
  "HFOF11",
  "HGBS11",
  "HGCR11",
  "HGJH11",
  "HGLG11",
  "HGRE11",
  "HGRU11",
  "HMOC11",
  "HTMX11",
  "HUSC11",
  "IRDM11",
  "JRDM11",
  "JSRE11",
  "KNCR11",
  "KNHY11",
  "KNIP11",
  "KNRE11",
  "KNRI11",
  "MALL11",
  "MAXR11",
  "MBRF11",
  "MFII11",
  "MGFF11",
  "MXRF11",
  "NSLU11",
  "NVHO11",
  "ONEF11",
  "ORPD11",
  "OUCY11",
  "OUJP11",
  "PABY11",
  "PDDA11B",
  "PLRI11",
  "PORD11",
  "PQDP11",
  "PRSV11",
  "RBBV11",
  "RBCB11",
  "RBDS11",
  "RBGS11",
  "RBRD11",
  "RBRF11",
  "RBRR11",
  "RBVO11",
  "RDES11",
  "RDPD11",
  "REIT11",
  "RNGO11",
  "SAAG11",
  "SCPF11",
  "SDIL11",
  "SHPH11",
  "SPTW11",
  "TBOF11",
  "TFOF11",
  "TGAR11",
  "THRA11",
  "TRNT11",
  "TRXL11",
  "UBSR11",
  "VISC11",
  "VLOL11",
  "VRTA11",
  "WPLZ11",
  "XPCM11",
  "XPIN11",
  "XPLG11",
  "XPML11",
  "XTED11",
  "BBSD11",
  "BOVA11",
  "BOVV11",
  "BRAX11",
  "DIVO11",
  "ECOO11",
  "FIND11",
  "FNAM11",
  "FNOR11",
  "FPOR11",
  "FSRF11",
  "FSTU11",
  "ISUS11",
  "IVVB11",
  "MATB11",
  "MMXM11",
  "PIBB11",
  "SMAL11",
  "SPXI11",
  "XBOV11",
  "XPOM11",
  "BEEF11",
  "FJTA11",
  "FJTA13",
  "FJTA15",
  "FJTA17",
  "LOGN12",
  "MYPK11",
  "MYPK12"]
for msg in consumer:
    print('nm')
    prices = {stock_order[i]:float(v) for i,v in enumerate(msg.value.decode('utf-8').split(';'))}
    save_price(prices)
    # break